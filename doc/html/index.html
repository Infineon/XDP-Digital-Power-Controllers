<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>XDPP1100 Firmware: XDPP1100 System Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_infineon.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">XDPP1100 Firmware
   </div>
   <div id="projectbrief">The firmware documentation for the XDPP1100 device family.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">XDPP1100 System Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sctMainpage_System_Toplevel_FWHW"></a>
System Top Level FW/HW View</h1>
<div class="image">
<img src="shasta_fw_bd.jpg" alt="shasta_fw_bd.jpg"/>
<div class="caption">
Firmware Hardware Interfacing Block Diagram</div></div>
 <h1><a class="anchor" id="sctMainpage_System_Toplevel"></a>
System Top Level View</h1>
<p>This chapter gives a short overview on the XDPP1100 Project itself. XDPP1100 is a multi-phase Brick Controller Product, see below</p>
<div class="image">
<img src="shasta_system.svg" alt="shasta_system.svg"/>
<div class="caption">
XDPP1100 System Level Functional Diagram</div></div>
 <h1><a class="anchor" id="sctMainpage_Feature_Set"></a>
Feature Set</h1>
<p>This chapter lists the main features of XDPP1100.</p>
<p>Isolated DCDC Digital Controller with fully configurable digital control loop and programmable uC subsystem</p><ul>
<li>Secondary side sensors with primary side signal emulation</li>
<li>High resolution analog front end sensors</li>
<li>Configurable voltage mode or current mode compensation, multiple modes of operation</li>
<li>Digital dual edge PWM w/ 156 ps resolution</li>
<li>Extensive fault monitoring including OCP, OVP, OTP</li>
<li>uC firmware implementation of internal bus and external interfaces, including PMBUS, GPIO, and secondary bus</li>
<li>on-chip emulated multi-time programmable non-volatile memory (NVM)</li>
</ul>
<p>Covers typical topologies in 50 W - 1kW power range</p><ul>
<li>Half-Bridge (HB)</li>
<li>Full-Bridge (FB)</li>
<li>Phase shifted full bridge (PS FB)</li>
<li>Active Clamp Forward (ACF)</li>
<li>Interleaved Active Clamp Forward (IACF)</li>
<li>Center Tap (CT) or Full Wave Rectification (FW)</li>
</ul>
<h1><a class="anchor" id="sctMainpage_HW_Functional_Block_Diagram"></a>
HW Functional Block Diagram</h1>
<p>The functional block diagram is outlined in the figure below.</p>
<div class="image">
<img src="shasta_functional_blocks.svg" alt="shasta_functional_blocks.svg"/>
<div class="caption">
Block Level Functional Diagram</div></div>
 XDPP1100 consists of following functional blocks:</p>
<p>XDPP1100 Functional Partitioning</p><ul>
<li>Analog Infrastructure (Reference, LDO, LO/PLL)</li>
<li>Analog Sensor/IF (Mux, Amp, ADC, DAC)</li>
<li>Analog Sensor Processor<ul>
<li>Offset/Gain Trim and Offset/Scale Adjustments</li>
<li>Decimate and sample</li>
<li>High speed comparators</li>
</ul>
</li>
<li>Control Loop Elements<ul>
<li>Error Amp</li>
<li>Compensator</li>
<li>Current/Flux Balance</li>
<li>Feedforward</li>
<li>PWM/Sync Rec Control</li>
</ul>
</li>
<li>Control Loop Management<ul>
<li>Loop Mode</li>
<li>Voltage/Current Protection</li>
<li>Fault Manager</li>
<li>Voltage Target Control</li>
<li>On/Off Control (Master State Machine)</li>
</ul>
</li>
<li>Digital Infrastructure<ul>
<li>IOs and Interfaces</li>
<li>Internal Bus</li>
<li>CPU Subsystem</li>
<li>Peripherals Hardware/Firmware Partitioning occurs for every function</li>
</ul>
</li>
<li>Virtual architecture partitioning set by hw/fw codesign</li>
<li>architect for flexibility and performance</li>
</ul>
<h1><a class="anchor" id="sctMainpage_HW_Architecture"></a>
HW Architecture</h1>
<p>XDPP1100's HW Architecture is partitioned as follows</p>
<div class="image">
<img src="shasta_hw_architecture.png" alt="shasta_hw_architecture.png"/>
<div class="caption">
HW Architecture</div></div>
 <h1><a class="anchor" id="sctMainpage_CPUS_Architecture"></a>
CPUS Architecture</h1>
<p>XDPP1100 CPUS contains the main controller centric building blocks and interface peripherals </p><div class="image">
<img src="shasta_cpus_architecture.png" alt="shasta_cpus_architecture.png"/>
<div class="caption">
CPUS Architectural Diagram</div></div>
<ul>
<li>CPU:<ul>
<li>ARM CortexM0 module processor running up 100MHz, embedding 32bit CPU, NVIC (32irq input lines sources), WIC (wakeup interrupt controller), DAP (debug access port)</li>
</ul>
</li>
<li>MEMORIES:<ul>
<li>RAM1, RAM2, ROM, OTP</li>
</ul>
</li>
<li>Peripherals:<ul>
<li>CSC (SCU, CGU, RGU)</li>
<li>16 Channels DMA controller</li>
<li>2x 8bit GPIO</li>
<li>3x 2x32bit TIMER</li>
<li>32bit WDT</li>
<li>RAM, ROM, OTP wrappers</li>
</ul>
</li>
<li>Bus Structure:<ul>
<li>BUS matrix 2x8 (0 WS switch latency)<ul>
<li>4x AHB2APB bridge</li>
</ul>
</li>
</ul>
</li>
<li>Added peripherals:<ul>
<li>I2C/PMBUS controller</li>
<li>I2C M/S controller</li>
</ul>
</li>
</ul>
<p>DC/DC dedicated peripherals:</p><ul>
<li>BIF_REG registers<ul>
<li>Loop control/configuration/trim registers</li>
<li>voltage ramp control, filters, telemetry, fault manager, on-off, power mode</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="sctMainpage_FW_Feature_set"></a>
FW Feature Set</h1>
<p>This section lists the main FW features comprising the XDPP1100 project.</p>
<p>Code Management, RTOS, Drivers</p><ul>
<li>ROM, OTP, EEPROM, RAM Configuration Management</li>
<li>ROM / OTP / EEPROM / FW / BIF / PMBUS parameter management</li>
<li>multi-config and config defaults</li>
<li>Pin Configurability/IO access GPx, TMUX, TBUS, MDAC, XV</li>
<li>Enhanced BIST Access</li>
<li>Secondary I2C Port I2C/PMBUS Interface/Command Support</li>
<li>Command Definition and Execution</li>
<li>Customized Commands</li>
<li>Configuration/Password Management</li>
<li>Command Modification/Management HW/FW Peripherals</li>
<li>Voltage Control</li>
<li>On/Off Control</li>
<li>Telemetry</li>
<li>Fault Manager</li>
<li>Power Manager</li>
<li>Loop Manager</li>
<li>Interrupt Manager</li>
<li>GP HW Peripherals: S/H, ADC, DAC, comparators, etc FW Debugging and Analysis capabilities</li>
<li>Test, debug, monitor</li>
<li>Control Enhancement</li>
<li>Topology Enhancements: Balance, Dead Time,</li>
<li>Startup specific behavior</li>
<li>Fault Monitoring/Management/Dynamic Adjustment</li>
<li>State Monitoring</li>
<li>System Estimation: Iin, Vin, Pin/Pout, Cout, Lout, Remote Sense</li>
</ul>
<h1><a class="anchor" id="sctMainpage_FW_Toplevel"></a>
FW Top Level View</h1>
<p>This chapter deals with the top-level architecture and requirements for the XDPP1100 Firmware. Its FW architecture is driven by the following (non-functional) <b>objectives:</b> </p><ul>
<li>precise and clean encapsulation of functionality into source code modules</li>
<li>re-usability of such modules for current and future XDPP1100 products</li>
<li>usage of an off-the-shelf RTOS to support encapsulation of different FW functionalities</li>
<li>guaranteed and predictable execution of hard real-time functionality,</li>
<li>best-effort execution of soft real-time functionality</li>
<li>allows a broad audience of developers and application engineers to implement and maintain products and applications for the XDPP1100 family of products, avoiding long learning curves for FW changes.</li>
</ul>
<p>The top-level (functional) <b>requirements</b> for the FW architecture are as follows:</p><ul>
<li>keep the interrupt latency as low as possible to allow predictable hard real-time interrupt execution. Especially relevant parts of the RTX RTOS implementation, the Fault and I2C interrupt handling rule the hard real-time capabilities of the FW. See also <a class="el" href="index.html#sctMainpage_Real_Time">Real-Time Requirements</a>.</li>
<li>allow the usage of interrupt handlers that can potentially operate decoupled from any RTOS interaction (so called 'unmanaged interrupts'). For less strict real-time requirements the use of multiple 'managed interrupts' on one or more interrupt levels is possible. See the RTOS chapter at <a class="el" href="pg_shasta__r_t_x.html#sctShasta_RTX_Intro">Introduction</a> for details on the different classes of real-time behaviour.</li>
<li>a ROM-based approach for the actual FW image, enhanced by a patching procedure that allows to replace or enhance functionality in ROM by patches stored in OTP. Such patches are managed by the user and the FW itself. The FW contained in ROM uses a jump-and-check mechanism for all important and vital functions and modules that checks against a patch table. See <a class="el" href="pg_shasta__patch.html">Patch FW Module</a> for more details.</li>
<li>use of Doxygen as the tool for in-source documentation to avoid any "media discontinuities" when implementing source code in text files and updating related documentation (in non-text files).</li>
<li>The overall FW architecture is event-driven (versus timing driven): The FW is not required to run hard real-time periodic tasks (like filters and such), except for the (soft real-time) system tick of the RTOS. All other FW functionality is essentially event-driven:<ol type="1">
<li>PMBUS transactions are triggered by the main CPU</li>
<li>Operation and Maintenance functionality is low speed, running on a system tick period.</li>
</ol>
</li>
</ul>
<dl class="section user"><dt>FW Architecture</dt><dd></dd></dl>
<p>The Firmware for XDPP1100 is structured in layers according to the figure below.</p>
<div class="image">
<img src="shasta_fw_architecture.svg" alt="shasta_fw_architecture.svg"/>
<div class="caption">
Layered FW Architecture </div></div>
<ol type="1">
<li><b>The User Layer:</b> It is the top-most level containing all functions related to user interaction. This level contains functions which can be provided by the user and reside in an OTP for example. These functions define how the user experiences the interaction with XDPP1100 via different interfaces like PMBus, I2C, RS232. These interfaces will be used for controlling the device in different operational situations like dcdc control, configuration, debugging, maintenance or patching.</li>
<li><b>The Application Layer 2:</b> This is a high-level layer if the functions defining an applications are to complex to put them into a single layer. This layer is optional and even more layers can be defined if it helps to bring more structure and clarity into the FW design.</li>
<li><b>The Application Layer 1:</b> This is a lower-level layer if the functions are defining a simple application.</li>
<li><b>The HW Driver:</b> This Layer defines the direct interaction with the underlying HW including interrupt service routines.</li>
</ol>
<p>Each layer is separated by an API which is defined in the respective header files. The API of each layer needs to be carefully thought through as it defines the quality and usability of the hierarchical FW design.</p>
<dl class="section user"><dt>Processing Architecture</dt><dd></dd></dl>
<p>Taking the objectives and the requirements into account, the processing architecture in terms of the priority levels looks as shown in the following diagram. </p><div class="image">
<img src="shasta_fw_prio_lvl.png" alt="shasta_fw_prio_lvl.png"/>
<div class="caption">
Priority Levels of XDPP1100 Firmware</div></div>
We find the following noteworthy details:</p><ul>
<li>The interrupt priority level, is configurable by the ARM and can be changed during run-time.</li>
<li>on RTOS thread level, the RTOS' scheduler makes the prio decisions and schedules threads as required by current threads priorities and threads readiness. The actual priorities of the threads are configured at build time in each FW module, see the documentation of each FW module at sctMainpage_FW_Mod.</li>
</ul>
<dl class="section user"><dt>Module Architecture</dt><dd></dd></dl>
<p>The following diagram outlines the module architecture of the XDPP1100 FW. As we see, every FW module operates under RTOS control, the RTOS scheduler decides on every RTOS event which thread has the highest priority and resumes it. The only exception to RTOS control are the unmanaged interrupts that have been introduced above. They do not communicate with the module threads through RTOS services, but may use other means (e.g. interrupt-protected shared variables).</p>
<p>Each module may call the HAL driver layer, thereby talking to the HW peripherals.</p>
<div class="image">
<img src="shasta_module_architecture.svg" alt="shasta_module_architecture.svg"/>
<div class="caption">
Module Architecture of XDPP1100 Firmware</div></div>
 <h1><a class="anchor" id="sctMainpage_Real_Time"></a>
Real-Time Requirements</h1>
<h2><a class="anchor" id="sctMainpage_Int"></a>
Interrupt Handling</h2>
<p>High Priority Interrupts <a class="el" href="system__shasta_8c.html#aea6db4cb8a72e7961211a8f99f9774bf">priority_0_IRQs</a> Medium Priority Interrupts <a class="el" href="system__shasta_8c.html#af630e7699f9377252aee0a4264f49436">priority_1_IRQs</a> Low Priority Interrupts <a class="el" href="system__shasta_8c.html#a7be5661d30cb9d46be1178e9230821e4">priority_3_IRQs</a></p>
<h2><a class="anchor" id="sctMainpage_Thread"></a>
Thread Handling</h2>
<table class="doxtable">
<tr>
<th>Thread ID </th><th>Priority  </th></tr>
<tr>
<td><a class="el" href="pmbus__drv_8h.html#a36eb0f83b4fc043e944a193fe882f8fc">tid_PMBUS_Thread</a> </td><td>osPriorityAboveNormal </td></tr>
<tr>
<td><a class="el" href="regulation__drv_8h.html#a48fb17e39ca3550a2421b680ec2c9458">tid_Regulation_Thread</a> </td><td>osPriorityNormal </td></tr>
<tr>
<td><a class="el" href="telemetry__drv_8h.html#a64ca304eb291cad95c69fb2d4926ec8d">tid_Telemetry_Thread</a> </td><td>osPriorityNormal </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Nov 8 2023 10:17:07 for XDPP1100 Firmware by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
