<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>XDPP1100 Firmware: Structured Exception Handling in C</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_infineon.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">XDPP1100 Firmware
   </div>
   <div id="projectbrief">The firmware documentation for the XDPP1100 device family.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pg_lib__struct_exc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Structured Exception Handling in C </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Structured Exception Handling is a technique that separates the code for exception handling from the normal application code. Instead of checking the returned success or failure value after each function call and acting upon it, the program flow directly jumps to the exception handler after the exception has been "thrown".<br />
 The exception itself contains all the essential information for identifying and handling it. This might be just an exception ID or additional information like a stack trace.<br />
 In case you are totally unfamiliar with the concept of throwing exceptions and want to convince yourself why using this technique is a good idea or you just need to refresh your memory, read, for instance, the documentation of some development frameworks like <a href="http://msdn.microsoft.com/en-us/library/ms229014%28v=vs.110%29.aspx">MSDN - Design Guidelines for Exceptions</a> or have a look at <a href="http://en.wikipedia.org/wiki/Exception_handling">Wikipedia: Exception Handling</a>.</p>
<h1><a class="anchor" id="sctLib_StructExc_Usage"></a>
Example Usage</h1>
<p>To integrate the simple Structured Exception Handling technique into a CMSIS-RTOS environment simply make use of the macros in <a class="el" href="cmsis__os__exceptions_8h.html" title="Library for using a simple Structured Exception Handling technique in an CMSIS-RTOS environment with ...">cmsis_os_exceptions.h</a> which is included in <a class="el" href="cmsis__os__ext_8h.html" title="API for using a CMSIS-RTOS with custom extensions. ">cmsis_os_ext.h</a> as shown in this example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="cmsis__os__ext_8h.html">cmsis_os_ext.h</a>&quot;</span>   <span class="comment">// The exception library is an extension of a CMSIS-RTOS.</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="fw__bool_8h.html">fw_bool.h</a>&quot;</span>        <span class="comment">// boolean type</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// RTOS definition of threads</span></div>
<div class="line"><a class="code" href="cmsis__os_8h.html#aee93d929beb350f16e5cc7fa602e229f">osThreadDef</a>(<a class="code" href="____main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>, <a class="code" href="cmsis__os_8h.html#a7f2b42f1983b9107775ec2a1c69a849aa45a2895ad30c79fb97de18cac7cc19f1">osPriorityNormal</a>, 1, 0);</div>
<div class="line"><a class="code" href="cmsis__os_8h.html#aee93d929beb350f16e5cc7fa602e229f">osThreadDef</a>(module_thread, <a class="code" href="cmsis__os_8h.html#a7f2b42f1983b9107775ec2a1c69a849aa45a2895ad30c79fb97de18cac7cc19f1">osPriorityNormal</a>, 1, 0);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Maximum for parameter &quot;index&quot; of risky_function.</span></div>
<div class="line"><span class="preprocessor">#define MAX_SIZE   10</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Demonstrates that throwing exceptions bypasses the function call chain.</span></div>
<div class="line"><span class="comment">// @throws ILLEGAL_PARAMETER from risky_function.</span></div>
<div class="line"><span class="keywordtype">void</span> intermediate_function(uint8_t num);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Function on the lowest level which can throw exceptions.</span></div>
<div class="line"><span class="comment">// @param array     An array with maximum size MAX_SIZE</span></div>
<div class="line"><span class="comment">// @param num       Number which should not exceed MAX_SIZE-1</span></div>
<div class="line"><span class="comment">// @return a sum over @p num elements of @p array.</span></div>
<div class="line"><span class="comment">// @throws ILLEGAL_PARAMETER if</span></div>
<div class="line"><span class="comment">//         - parameter == NULL</span></div>
<div class="line"><span class="comment">//         - num &gt;= MAX_SIZE</span></div>
<div class="line">uint32_t risky_function(uint8_t* array, uint8_t num);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Initializes the RTOS and threads</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="____main_8c.html#a0960c8571aac1536f7e7e5f2590d1ff9">__main</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="cmsis__os__ext_8c.html#aea69f124d71b89f65729704a45019a96">osExtKernelInitialize</a>();</div>
<div class="line">    <a class="code" href="cmsis__os_8h.html#adfeb153a84a81309e2d958268197617f">osThreadId</a> main_thread_id = <a class="code" href="cmsis__os__ext_8c.html#aed4eb10c5fc1854f5e25f9210ec0627f">osExtThreadCreate</a>(<a class="code" href="cmsis__os_8h.html#af0c7c6b5e09f8be198312144b5c9e453">osThread</a>(<a class="code" href="____main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>), NULL);</div>
<div class="line">    <a class="code" href="cmsis__os_8h.html#adfeb153a84a81309e2d958268197617f">osThreadId</a> module_thread_id = <a class="code" href="cmsis__os__ext_8c.html#aed4eb10c5fc1854f5e25f9210ec0627f">osExtThreadCreate</a>(<a class="code" href="cmsis__os_8h.html#af0c7c6b5e09f8be198312144b5c9e453">osThread</a>(module_thread), NULL);</div>
<div class="line">    <a class="code" href="cmsis__os_8h.html#aab668ffd2ea76bb0a77ab0ab385eaef2">osKernelStart</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// main() is an example that</span></div>
<div class="line"><span class="comment">// - sets up the top-level exception guard using the TRY macro</span></div>
<div class="line"><span class="comment">// - illustrates how to catch specific and remaining exceptions from functions called at main() level,</span></div>
<div class="line"><span class="comment">// using CATCH and CATCH_OTHERS</span></div>
<div class="line"><span class="comment">// - illustrates how to close the exception guard using the TRY_END macro</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="____main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Set up exception guard (TRY macro) to catch any exception potentially thrown by</span></div>
<div class="line">    <span class="comment">// intermediate_function() and its childs.</span></div>
<div class="line">    <a class="code" href="cmsis__os__exceptions_8h.html#ad2746371528bdf15c3910b7bf217dac0">TRY</a></div>
<div class="line">    {</div>
<div class="line">        intermediate_function(MAX_SIZE);</div>
<div class="line">        <span class="comment">// Stuff that should be done if there was no exception.</span></div>
<div class="line">        <span class="comment">// Do NOT use &quot;return&quot; here because the TRY_END macro which removes the last guard would not be executed.</span></div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="cmsis__os__exceptions_8h.html#a0e92453d34d1a100d58c6177fd7747fb">CATCH</a>(<a class="code" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa7dcca268506a6a937762fa24092b2894">ILLEGAL_PARAMETER</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Handle specific exception.</span></div>
<div class="line">        <span class="comment">// Do NOT use &quot;return&quot; here because the TRY_END macro which removes the last guard would not be executed.</span></div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="cmsis__os__exceptions_8h.html#aad867ef569869bd836e12dcba471aa95">CATCH_OTHERS</a></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Handle all other exceptions.</span></div>
<div class="line">        <span class="comment">// Do NOT use &quot;return&quot; here because the TRY_END macro which removes the last guard would not be executed.</span></div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="cmsis__os__exceptions_8h.html#a42527369fadf3dcd985f6b58160284f1">TRY_END</a></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Does some stuff, but does not throw an exception.</span></div>
<div class="line"><span class="keywordtype">void</span> intermediate_function(uint8_t num)</div>
<div class="line">{</div>
<div class="line">    uint8_t array[MAX_SIZE];</div>
<div class="line">    <span class="comment">// Initialize array and do other stuff.</span></div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line"></div>
<div class="line">    uint32_t value = risky_function(array, num);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Do more stuff.</span></div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Does some stuff, too and is called by intermediate_function().</span></div>
<div class="line"><span class="comment">// Throws an exception which is then handled on main() level by</span></div>
<div class="line"><span class="comment">// &#39;unwinding&#39; the call stack and passing the exception data back</span></div>
<div class="line"><span class="comment">// to where it is actually handled.</span></div>
<div class="line">uint32_t risky_function(uint8_t* array, uint8_t num)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// First check for illegal parameters.</span></div>
<div class="line">    <a class="code" href="cmsis__os__exceptions_8h.html#a7bc5cf3ad6ddce8de80fbe0dae4b8386">THROW_IF</a>(parameter == NULL, <a class="code" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa7dcca268506a6a937762fa24092b2894">ILLEGAL_PARAMETER</a>);</div>
<div class="line">    <a class="code" href="cmsis__os__exceptions_8h.html#a7bc5cf3ad6ddce8de80fbe0dae4b8386">THROW_IF</a>(index &gt;= MAX_SIZE, <a class="code" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa7dcca268506a6a937762fa24092b2894">ILLEGAL_PARAMETER</a>);</div>
<div class="line"></div>
<div class="line">    uint32_t sum = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; index; i++)</div>
<div class="line">    {</div>
<div class="line">        sum += parameter[i];</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> sum;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// module_thread() is an example that</span></div>
<div class="line"><span class="comment">// - sets up the thread-level exception guard using the TRY_AGAIN macro for a thread that</span></div>
<div class="line"><span class="comment">// runs forever under RTX control</span></div>
<div class="line"><span class="comment">// - illustrates how to catch specific and remaining exceptions from functions called by the</span></div>
<div class="line"><span class="comment">// RTX-controlled module_thread() using CATCH and CATCH_OTHERS</span></div>
<div class="line"><span class="comment">// - illustrates how to close the exception guard using the TRY_END macro</span></div>
<div class="line"><span class="keywordtype">void</span> module_thread(<span class="keyword">const</span> <span class="keywordtype">void</span>* thread_input)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (;;) <span class="comment">// ever (set up a new guard in case of a previous exception)</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="cmsis__os__exceptions_8h.html#aefda3c41e567de5717e579212109a355">TRY_AGAIN</a> <span class="comment">// until an exception occurs</span></div>
<div class="line">        {</div>
<div class="line">            module_thread_function();</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="cmsis__os__exceptions_8h.html#aad867ef569869bd836e12dcba471aa95">CATCH_OTHERS</a></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// handle all exceptions. Access an exception with EXCEPTION</span></div>
<div class="line">            <span class="comment">// EXCEPTION.type, ...</span></div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="cmsis__os__exceptions_8h.html#a42527369fadf3dcd985f6b58160284f1">TRY_END</a></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// module_thread_function(), called by module_thread()</span></div>
<div class="line"><span class="comment">// module_thread_function() casts one exception into another.</span></div>
<div class="line"><span class="comment">// @throws FAILED_COMMUNICATION for demonstration purpose.</span></div>
<div class="line"><span class="keywordtype">void</span> module_thread_function(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="cmsis__os__exceptions_8h.html#ad2746371528bdf15c3910b7bf217dac0">TRY</a></div>
<div class="line">    {</div>
<div class="line">        intermediate_function(MAX_SIZE);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="cmsis__os__exceptions_8h.html#a0e92453d34d1a100d58c6177fd7747fb">CATCH</a>(<a class="code" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa7dcca268506a6a937762fa24092b2894">ILLEGAL_PARAMETER</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Do stuff like logging the exception.</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Throw an exception of another type.</span></div>
<div class="line">        <span class="comment">// Note: This type does not apply here. It is just used for demonstration purpose.</span></div>
<div class="line">        <a class="code" href="cmsis__os__exceptions_8h.html#a58c579d2d0639c481f6f404d20de00e9">THROW_OTHER</a>(<a class="code" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa0d80fe80390ba8d708c0cb2fa707f08d">FAILED_COMMUNICATION</a>);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="cmsis__os__exceptions_8h.html#a0e2a75478cd44f1666a6aca626c5c50b">FINALLY</a></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// FINALLY is always executed:</span></div>
<div class="line">        <span class="comment">// - in case the TRY block did not throw anything</span></div>
<div class="line">        <span class="comment">// - CATCH was entered and the exception was handled,</span></div>
<div class="line">        <span class="comment">// - CATCH was entered and THROW_OTHER was used</span></div>
<div class="line">        <span class="comment">// - a thrown exception was not caught due to a missing CATCH statement</span></div>
<div class="line">        <span class="comment">// Remember to NOT use &quot;return&quot; here so that TRY_END is executed.</span></div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="cmsis__os__exceptions_8h.html#a42527369fadf3dcd985f6b58160284f1">TRY_END</a></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="sctLib_StructExc_Implementation"></a>
Implementation</h1>
<p>The basic idea is presented in <a href="http://www.on-time.com/ddj0011.htm">Exception Handling in C without C++</a>. The goal was to provide a simple exception-handling library in C with the following requirements:</p><ul>
<li>No dynamic memory allocation.</li>
<li>Robust (the exception handling library itself must not fail).</li>
<li>Must support both exception-handlers and finally-handlers.</li>
<li>Reentrant for multitasking applications.</li>
</ul>
<p>That idea was paired with <a href="http://www.di.unipi.it/~nids/docs/longjump_try_trow_catch.html">Exceptions in C with Longjmp and Setjmp</a> which provided proposals for macros that look like the try-throw-catch statements from C++.<br />
 </p><dl class="section note"><dt>Note</dt><dd><b>Edit</b>: The same approach was used and even further improved in <a href="http://www.vishia.org/Jc/html/Exception_Jc.html">CRuntimeJavalike</a> (german).</dd></dl>
<p>These two combined ideas plus some additional work resulted in an exception handling mechanism whose functionality is nearly the same as the one in C++. The only difference is that it is not allowed to use a <code>return</code> statement within the TRY, CATCH or FINALLY block. The reason for this is that there are no destructors in C which could execute the TRY_END macro for cleaning up the whole TRY block before the <code>return</code> statement takes effect.</p>
<dl class="section user"><dt>How it works</dt><dd></dd></dl>
<p>The elementary functions of this Structured Exception Handling implementation are setjmp() and longjmp() from the ANSI C library (header file <code>setjmp.h</code>).<br />
 The basic procedure is to</p><ol type="1">
<li>set up a guard of type <code>jmp_buf</code> before entering a <em>risky function</em>. <em>Risky</em> means that the function contains a path along its sub-functions that might throw an exception. The guard is taken by the function <code>setjmp</code> to save the values of all processor registers (including stack pointer and program counter).</li>
<li>Then the risky function is executed. In case the function throws an exception on any level along its call chain the function <code>longjmp</code> uses the guard to restore the environment to the point in time when the guard was set up with <code>setjmp</code>. Additionally <code>longjmp</code> passes the exception ID to <code>setjmp</code>.</li>
<li>This exception ID is then returned by <code>setjmp</code> and taken as the selector for an appropriate exception handling routine.</li>
</ol>
<p>This procedure has been enhanced with the possibilities</p><ul>
<li>to add additional information to an exception besides its ID (see Exception_t).</li>
<li>to nest TRY blocks within one another and within any number of sub-functions.</li>
<li>to use TRY blocks within multiple threads of an RTOS.</li>
</ul>
<p>For the last two points a linked list of references to locally created guards was added to the context of each thread. Each TRY macro adds a guard and each TRY_END removes it if it was not already removed by a THROW. The program flow for the TRY, CATCH, THROW macros is shown in the following image: </p><div class="image">
<img src="cmsis_os_exceptions.svg" alt="cmsis_os_exceptions.svg"/>
<div class="caption">
State flow chart of the implemented Structured Exception Handling macros</div></div>
 <dl class="section user"><dt>Adjustment of setjmp.h</dt><dd></dd></dl>
<p>Since the environment that has to be saved is dependent on the processor, the size of the guard or rather of the type <code>jmp_buf</code> had to be adjusted. For that purpose the sections 4.2.3.2 and 5.11 of the document <a href="http://infocenter.arm.com/help/topic/com.arm.doc.ihi0039c/IHI0039C_clibabi.pdf">ARM C Library ABI</a> were considered.<br />
 It reads:<br />
 <em>" In deference to VFP, XScale Wireless MMX, and other co - processors manipulating 8 - byte aligned types, a jmp_buf must be 8 - byte aligned. The minimum jmp_buf size is calculated as follows:</p><ul>
<li>SP, LR: 2x4; reserved to setjmp implementation: 4x4; Total 3x8 bytes</li>
<li>General purpose register save: 8x4; Total 4x8 bytes</li>
<li>Floating point register save: 8x8; Total 8x8 bytes</li>
<li>WMMX (if present): 5x8; Total 5x8 bytes</li>
</ul>
<p>Total: 20x8 = 160 bytes = 20 8 - byte double-words.<br />
 If WMMX can be guaranteed not to be present this can be reduced to 15x8 = 120 bytes.<br />
 If floating point hardware can be guaranteed not to be present this can be further reduced to 7x8 = 56 bytes. "</em></p>
<p>For this implementation <code>jmp_buf</code> was set to the minimum of 7x8 = 56 bytes: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> __int64 jmp_buf[7];</div>
</div><!-- fragment --><dl class="section user"><dt>Timing</dt><dd></dd></dl>
<p>On an ARM Cortex-M0 with a clock frequency of 100MHz the following runtime values were measured:</p>
<p>TRY macro: Setup of a TRY block.</p><ul>
<li>before the first instruction within the block is executed: <b>3.14us</b> at thread-level and <b>1.76us</b> at ISR-level</li>
<li>internal <a class="el" href="cmsis__os_8h.html#a3b571de44cd3094c643247a7397f86b5">osKernelRunning()</a>: <b>0.46us</b> at thread-level and <b>0.36us</b> at ISR-level</li>
<li>internal osThreadGetId: <b>1.57us</b> at thread-level and <b>0.28us</b> at ISR-level</li>
<li>internal setjmp: <b>0.40us</b></li>
</ul>
<p>THROW macro: Throwing an exception</p><ul>
<li>before the first instruction within the corresponding CATCH block is executed: <b>4.18us</b> at thread-level and <b>2.79us</b> at ISR-level</li>
<li>internal <a class="el" href="cmsis__os_8h.html#a3b571de44cd3094c643247a7397f86b5">osKernelRunning()</a>: <b>0.46us</b> at thread-level and <b>0.36us</b> at ISR-level</li>
<li>internal osThreadGetId: <b>1.57us</b> at thread-level and <b>0.28us</b> at ISR-level</li>
<li>internal longjmp: <b>0.38us</b></li>
</ul>
<dl class="section user"><dt>Memory footprint</dt><dd></dd></dl>
<ul>
<li>Stack usage: <b>80 bytes</b> per TRY block (THROW is a function call)</li>
<li>Code size: <b>178+200 bytes</b> for the code in <a class="el" href="cmsis__os__exceptions_8c.html" title="Implementation of a simple structured exception handling technique for use in an CMSIS-RTOS environme...">cmsis_os_exceptions.c</a> and <a class="el" href="cmsis__os__ext_8c.html" title="Implementation of functions which extend those from the CMSIS-RTOS API. ">cmsis_os_ext.c</a></li>
<li>Data objects: <b>24 + 20*OS_TASKCNT bytes</b> for <code>osException</code> and <code>osExtension</code> </li>
</ul>
<h1><a class="anchor" id="sctLib_StructExc_Comparison"></a>
Comparison to usual exception handling</h1>
<dl class="section user"><dt>Costs</dt><dd></dd></dl>
<ul>
<li><b>Runtime overhead for exceptions</b> <br />
 In case of an exception by simply returning the failure value and checking it afterwards costs 0.10us per level of the function call chain (on an ARM Cortex-M0 running on 100MHz) whereas a THROW needs 4.18us until it reaches its corresponding CATCH (optimization possible, see section <a class="el" href="pg_lib__struct_exc.html#sctLib_StructExc_Implementation">Implementation</a> - Timing).</li>
<li><b>Possible misuse</b> <br />
 A developer could use the direct jumps to control the normal flow of program execution similar to <code>gotos</code> or he could build up too many exception guards at every level along the function call chain (-&gt; increase of runtime and stack usage).<br />
 Using the jumps is intended for exception handling only and most of the time one or two exception guards per thread are sufficient. As soon as the developer is aware of these facts, the misuse disadvantage is negligible.</li>
</ul>
<dl class="section user"><dt>Benefits</dt><dd></dd></dl>
<ul>
<li><b>Runtime reduction for normal execution</b> <br />
 Most of the time no exception will occur during the program execution. So the longer the function call chain gets the more intermediate checks for a failure value plus the corresponding return statements are saved.</li>
<li><b>Maintainability of code</b> <br />
 The code for exception handling is separated from the application code and thus can be centralized which greatly improves the readability of the overall code.</li>
<li><b>No ignoration of exceptions</b> <br />
 In case of exception handling by returning failure values the programmer might forget to check this value along the call chain. Even a static code analysis tool could overlook the mistake in case that a function returns both success and failure values and only the success value is used.</li>
</ul>
<p>For more technical information on this topic you may</p><ul>
<li>have a look at <a href="http://www.embedded.com/electronics-blogs/programming-pointers/4026007/Bail-return-jump-or----throw-">Bail, return, jump, or . . . throw?</a></li>
<li>or also google words like "embedded exception handling setjmp". </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Nov 8 2023 10:17:01 for XDPP1100 Firmware by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
