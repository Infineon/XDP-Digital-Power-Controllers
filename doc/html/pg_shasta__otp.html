<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>XDPP1100 Firmware: OTP Driver Module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_infineon.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">XDPP1100 Firmware
   </div>
   <div id="projectbrief">The firmware documentation for the XDPP1100 device family.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pg_shasta__otp.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">OTP Driver Module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sctShasta_Otp_Intro"></a>
Introduction</h1>
<p>This section deals with OTP drivers and the otp hardware access layer(HAL). OTP stands for "One time programmable" memory. As its name implies, the OTP device can only be written once. Its physical characteristics is similar to flash memory except former can only be written once while latter can be written multiple times.<br />
 In Shasta, there is one OTP, with up to four partitions. OTP driver and the HAL handle both read/write access for all partitions. The first partition is used to store FW, Trim, Register and PMBus configuration data. See <a class="el" href="pg_shasta__configurator.html">Configurator FW Module</a>.<br />
 The other partitions are used FW patches. See <a class="el" href="pg_shasta__patch.html">Patch FW Module</a>. <br />
 The OTP device is organized as 4 32-bit words or 16 8-bit bytes or 128 bit per memory location named "otp row". For a virgin device, even rows contain all 0s while odd rows contain all 1s when row is counting from 0. FW needs not care about this bit flips it just sees a virgin device as all 0s.</p>
<dl class="section user"><dt>OTP Read</dt><dd>The OTP Wrapper is build such that data can be read with a direct access to AHB.</dd></dl>
<dl class="section user"><dt>OTP Write</dt><dd>Writing and programming means exactly the same in this write up and is used interchangeably throughout this document. Writing operates on two different modes, the poll and interrupt modes. In Shasta FW, interrupt mode is used. Poll mode is used for building a Lauterbach mem_loader driver and will not discussed here. Under interrupt mode, RTX message is used to wait for the OTP "write completion" message being sent from the interrupt service handler. Caller write one chunk of data, then wait for "write completion" message. Upon getting that message, issue another chunk of data to write. Please read <a class="el" href="pg_shasta__otp.html#sctShasta_Otp_Write">OTP Data Write</a> for steps of OTP writing.</dd></dl>
<p>See</p><ul>
<li><a class="el" href="otp__drv_8h.html" title="OTP device access layer. ">otp_drv.h</a> for details on the API</li>
<li><a class="el" href="otp__fs_8h.html" title="OTP file system layer. ">otp_fs.h</a> for details on the file system API</li>
<li>CPUS ITS for details on the HW Interface <a href="https://sec-ishare.infineon.com/sites/shasta/Shared%20Documents/03_System/CPUS.pdf">https://sec-ishare.infineon.com/sites/shasta/Shared%20Documents/03_System/CPUS.pdf</a></li>
</ul>
<h1><a class="anchor" id="sctShasta_otp_driver_init"></a>
OTP Driver Initialization</h1>
<p>This functions enables clk, disables reset and power the OTP which takes roughly 400ms. Therefore the OTP keeps powered for the whole activation of the system. Only in sleep mode it will be switched off if needed. Since the OTP driver works closely with the RTX, the RTOS's message queue and message box should be initialized here. It also enables OTP interrupt services. Since writing to OTP takes a long time, interrupt service is used for OTP write.</p>
<h1><a class="anchor" id="sctShasta_Otp_Write"></a>
OTP Data Write</h1>
<p>This is the routine to write data into the otp memory. The mechanic of OTP writing is as follow:</p><ul>
<li>Caller provides a 4 32-bit word chunk.</li>
<li>OTP driver loads up the "cache line"</li>
<li>Set up the address register that the data will be written to</li>
<li>Prepare the interrupt mask</li>
<li>Issue an otp write instruction</li>
<li>Wait for OTP "write completion" message from the OTP interrupt service handler</li>
</ul>
<h1><a class="anchor" id="sctShasta_Otp_read"></a>
OTP Data Read</h1>
<p>This function just returns a pointer to the data which can be read directly via the AHB Interface.</p>
<h1><a class="anchor" id="sctShasta_Otp_file_structure"></a>
OTP File Structure</h1>
<p>The OTP is organized as a file structure, <a class="el" href="otp__fs_8h.html#a822d0027045dbf83793fc39bf6b55b23">Otp_File_System_Cmd_Types_t</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Nov 8 2023 10:17:01 for XDPP1100 Firmware by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
