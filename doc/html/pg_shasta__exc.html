<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>XDPP1100 Firmware: Exception Handling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_infineon.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">XDPP1100 Firmware
   </div>
   <div id="projectbrief">The firmware documentation for the XDPP1100 device family.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pg_shasta__exc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Exception Handling </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sctShasta_Exc_Intro"></a>
Introduction</h1>
<p>This page deals with the concept and architecture for handling exceptions that occur due to failures detected in the FW modules and in the hardware. Failures could occur during the startup/boot phase and/or during active operation once the Shasta controller has completed its startup.</p>
<p>Handling of exceptions is an integral and important part of the Shasta FW. It needs to ensure that all unusual situations and states of the FW <b>and</b> the device <b>and</b> the environment are detected and handled in a way that prevents catastrophic damage to the device and allows safe rebooting. Errors may be handled differently depending on which phase (boot or active operation) and where (in the OS kernel, in a module thread, in an interrupt request handler) they are detected in. For a list of errors and their associated reactions, refer to <a class="el" href="pg_shasta__exc.html#sctShasta_Exc_Known_Errors">List of Errors</a>.</p>
<p>Since there is often confusion about the <b>distinction between errors and exceptions,</b> their correlation is defined as follows: In general an <b>exception</b> is the detection of an <b>error</b> (e.g. defective memory cells, mistakes in the development process, wrong usage of an interface, etc.), which in consequence interrupts the normal program flow (also known as "throwing an exception"). Depending on where the exception was thrown, it leads to a more or less severe <b>issue</b> and thus has to be handled accordingly.</p>
<p>Once a module's thread starts its execution (in many cases, the threads run continuously throughout the operating time of the Shasta controller), it calls at least one routine. Each module also provides a return point should an exception be "thrown". At that point, information is written to an error log and the thread continues from the start again. At the point where the exception is thrown, relevant information may be logged and processing stops. All processing performed by the module up to that time is simply "forgotten" - i.e., the stack contents are no longer considered and nothing is popped from the stack. The RTOS provides an exception flow functionality to correlate the thread operation, allowing the correct return point in the thread to be determined. This approach provides for straightforward yet efficient error handling as the complexity is greatly reduced and no extensive stack handling procedures need to be implemented.</p>
<p>Exceptions are handled in the Shasta firmware similarly to the way that exceptions are processed in C++, in that TRY, THROW and CATCH statements are implemented. The code that could encounter errors are housed in a TRY (or TRY_FOREVER, etc.) statement, detected errors are reported using a THROW statement, while the handling of detected ("thrown") errors is initiated by means of a CATCH statement.</p>
<p>Details on standard C++ exception handling can be found on the Internet - for example, at <a href="https://en.wikibooks.org/wiki/C%2B%2B_Programming/Exception_Handling">C++ Programming/Exception Handling</a>.<br />
 Further details on the Shasta implementation can be found in <a class="el" href="pg_lib__struct_exc.html">Structured Exception Handling in C</a>.</p>
<h1><a class="anchor" id="sctShasta_Exc_Strategy"></a>
Exception Handling Strategy</h1>
<p>As soon as an exception is thrown the normal flow of program execution is interrupted and the corresponding <b>exception handler</b> of the current thread is executed. Afterwards the normal program flow is resumed at a point where the exception has no impact (e.g. at the end of a thread).<br />
 Each exception handler performs the following actions:<br />
</p><ul>
<li>Creates an entry within the log buffer for the error. This <b>error log</b> contains <br />
<ul>
<li>the <b>source</b> (see <a class="el" href="log_8h.html#ab59b6f06263786e0075630d69c3b04a4">Log_Source_t</a>), <br />
</li>
<li>the <b>severity level</b> (see <a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2d">Log_Severity_t</a>) and <br />
</li>
<li>the <b>exception descriptor</b> (see <a class="el" href="structos_exception__t.html">osException_t</a>). The exception descriptor indicates the type of error (its class) along with a program counter indicating in what thread the error was detected.<br />
 Error logs are created by calling <a class="el" href="log__app_8c.html#a2bb235330627e6e5d9d9801c230c24de">log_error()</a>.<br />
</li>
</ul>
</li>
<li>Executes a predefined handling sequence depending on the <b>severity level</b> (see <a class="el" href="pg_shasta__exc.html#sctShasta_Exc_Severity_Levels">Severity Levels and Reactions</a>) of the error. The severity level assigned to an error complies with the classifications set out in <a class="el" href="pg_shasta__exc.html#sctShasta_Exc_Known_Errors">List of Errors</a>.<br />
</li>
</ul>
<h2><a class="anchor" id="sctShasta_Exc_Severity_Levels"></a>
Severity Levels and Reactions</h2>
<p>Severity levels are classified as shown in the following table along with their corresponding reactions. The coding of the severity levels can be found here: <a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2d">Log_Severity_t</a>.</p>
<table class="doxtable">
<tr>
<th>Severity </th><th>Assigned exception handling </th></tr>
<tr>
<td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2da0666e7ee289b420b8f016b5269fa8244">EMERGENCY</a> </td><td>Power down the CPU subsystem.  </td></tr>
<tr>
<td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2dacda21a4a072f2261f6d4ab596599f8b0">CRITICAL</a> </td><td>Increment a reboot counter.<br />
 Reboot the firmware.  </td></tr>
<tr>
<td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2da2fd6f336d08340583bd620a7f5694c90">ERROR</a> </td><td>Deactivate the module.  </td></tr>
<tr>
<td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2da984de77c680eaff141ec910e25568a81">WARNING</a> </td><td>None (it is sufficient to abort the failing function by throwing an exception). </td></tr>
<tr>
<td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2da748005382152808a72b1a9177d9dc806">INFO</a> </td><td>None (no exception was thrown and the normal program flow continues).  </td></tr>
</table>
<h1><a class="anchor" id="sctShasta_Exc_Known_Errors"></a>
List of Errors</h1>
<p>The following list contains the errors that may occur during runtime of the firmware. Some of these errors are precisely defined whereas others are described in general (e.g. PMBus commands) since their resulting exceptions are handled in the same way. The list is ordered in tables grouped according to the first question shown below - the tables themselves specify the last four aspects.</p><ol type="1">
<li>In which <b>thread</b> was the exception thrown?</li>
<li>What <b>issue</b> was caused by the exception?</li>
<li>What <b>error</b> caused the exception to be thrown?</li>
<li>What is the <b>severity</b> of the exception here?</li>
<li>How is the exception <b>handled</b>?</li>
</ol>
<h2><a class="anchor" id="sctShasta_Exc_Known_Errors_Everywhere"></a>
Everywhere</h2>
<table class="doxtable">
<tr>
<th>Issue </th><th>Error </th><th>Severity </th><th>Handling </th></tr>
<tr>
<td>The hard fault handler is entered. </td><td>From <a class="el" href="pg_shasta__ref.html#sctRefDefinitiveGuideToArmCortexM0">The Definitive Guide to the ARM Cortex M0</a>, p.212, p.507ff  </td><td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2dacda21a4a072f2261f6d4ab596599f8b0">CRITICAL</a> </td><td><p class="starttd">See <a class="el" href="pg_shasta__exc.html#sctShasta_Exc_Severity_Levels">Severity Levels and Reactions</a>. </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>The watchdog timer timed out. </td><td><ul>
<li>
#HARD_FAULT: A system freeze prevented the watchdog timer from being reloaded. </li>
</ul>
</td><td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2dacda21a4a072f2261f6d4ab596599f8b0">CRITICAL</a> </td><td><p class="starttd">The firmware is rebooted automatically.<br />
 <b>Still increment the counter of reboots.???</b> </p>
<p class="endtd"></p>
</td></tr>
</table>
<h2><a class="anchor" id="sctShasta_Exc_Known_Errors_Boot"></a>
Boot sequence</h2>
<table class="doxtable">
<tr>
<th>Issue </th><th>Error </th><th>Severity </th><th>Handling </th></tr>
<tr>
<td>The maximum number of critical reboots is exceeded. </td><td><ul>
<li>
#HARD_FAULT: Too many <a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2dacda21a4a072f2261f6d4ab596599f8b0">CRITICAL</a> issues have happened. </li>
</ul>
</td><td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2da0666e7ee289b420b8f016b5269fa8244">EMERGENCY</a> </td><td><p class="starttd">See <a class="el" href="pg_shasta__exc.html#sctShasta_Exc_Severity_Levels">Severity Levels and Reactions</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>Applying all partial patches has failed. </td><td><ul>
<li>
<a class="el" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa7dcca268506a6a937762fa24092b2894">ILLEGAL_PARAMETER</a>: One patch has an incompatible version or contains invalid data. </li>
<li>
<a class="el" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fab1cbc05a88cbd1e46eae408900283edf">CORRUPT_MEMORY</a>: One patch has an invalid checksum. </li>
<li>
<a class="el" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094faad9dee005a3d0f9137b2ac1e0869f89b">TIMEOUT</a>: Requesting access to the OTP memory took too long. </li>
</ul>
</td><td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2da984de77c680eaff141ec910e25568a81">WARNING</a> </td><td><p class="starttd">Continue the boot sequence with those patches that have been applied before the first failing patch application. </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>The initialization of all modules failed. </td><td><ul>
<li>
<a class="el" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa0132f16d17c27d46245f9361645fe5e4">OUT_OF_RESOURCE</a>: The memory needed for the module's thread or mailbox exceeds the reserved OS memory, or the PMBus command table is too small for adding the module's commands. </li>
</ul>
</td><td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2dacda21a4a072f2261f6d4ab596599f8b0">CRITICAL</a> </td><td><p class="starttd">See <a class="el" href="pg_shasta__exc.html#sctShasta_Exc_Severity_Levels">Severity Levels and Reactions</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>The OS could not be started. </td><td><ul>
<li>
<a class="el" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa0132f16d17c27d46245f9361645fe5e4">OUT_OF_RESOURCE</a>: The memory needed for the OS stack exceeds the reserved OS memory. </li>
<li>
<a class="el" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa7dcca268506a6a937762fa24092b2894">ILLEGAL_PARAMETER</a>: The Cortex M0 CONTROL register indicates an invalid state for starting the OS. </li>
</ul>
</td><td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2dacda21a4a072f2261f6d4ab596599f8b0">CRITICAL</a> </td><td><p class="starttd">See <a class="el" href="pg_shasta__exc.html#sctShasta_Exc_Severity_Levels">Severity Levels and Reactions</a>.</p>
<p class="endtd"></p>
</td></tr>
</table>
<h2><a class="anchor" id="sctShasta_Exc_Known_Errors_Kernel"></a>
OS kernel, inter-thread communication</h2>
<table class="doxtable">
<tr>
<th>Issue </th><th>Error </th><th>Severity </th><th>Handling </th></tr>
<tr>
<td>An overflow stopped the OS. </td><td><ul>
<li>
<a class="el" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa0132f16d17c27d46245f9361645fe5e4">OUT_OF_RESOURCE</a>: Stack overflow, Interrupt Service Routine call overflow or Signal overflow </li>
</ul>
</td><td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2dacda21a4a072f2261f6d4ab596599f8b0">CRITICAL</a> </td><td><p class="starttd">See <a class="el" href="pg_shasta__exc.html#sctShasta_Exc_Severity_Levels">Severity Levels and Reactions</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>A thread was terminated abnormally. </td><td><ul>
<li>
<a class="el" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094faad9dee005a3d0f9137b2ac1e0869f89b">TIMEOUT</a>: The thread did not response on the message from the oam_thread(). </li>
</ul>
</td><td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2dacda21a4a072f2261f6d4ab596599f8b0">CRITICAL</a> </td><td><p class="starttd">See <a class="el" href="pg_shasta__exc.html#sctShasta_Exc_Severity_Levels">Severity Levels and Reactions</a>.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>An ITC mail could not be send. </td><td><ul>
<li>
<a class="el" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa0132f16d17c27d46245f9361645fe5e4">OUT_OF_RESOURCE</a>: The total number of unread mails exceeds the reserved OS memory or the mailbox of one of the subscribed threads is full. </li>
<li>
<a class="el" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa7dcca268506a6a937762fa24092b2894">ILLEGAL_PARAMETER</a>: The mail was not created correctly. </li>
</ul>
</td><td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2da984de77c680eaff141ec910e25568a81">WARNING</a> </td><td><p class="starttd">Abort sending the mail.</p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>The un-subscription to an ITC topic failed. </td><td><ul>
<li>
<a class="el" href="cmsis__os__exceptions_8h.html#acd9f76a1fbd8bc9084ff34add637094fa7dcca268506a6a937762fa24092b2894">ILLEGAL_PARAMETER</a>: The calling thread was not subscribed to the topic. </li>
</ul>
</td><td><a class="el" href="log_8h.html#aaeb722138d31144678ec9a1925b83e2da984de77c680eaff141ec910e25568a81">WARNING</a> </td><td><p class="starttd">Ignore the un-subscription. Still log the warning to indicate a developer error.</p>
<p class="endtd"></p>
</td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Nov 8 2023 10:17:00 for XDPP1100 Firmware by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
